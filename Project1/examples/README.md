# SM4 示例使用说明

本目录包含SM4加密算法的各种使用示例，从基本操作到高级功能，提供完整的学习和测试环境。

## 快速开始

### 1. 编译所有示例
```bash
make examples
```

### 2. 运行综合示例
```bash
./run_example
```
这个示例包含：
- 基本加密解密操作
- GCM模式认证加密
- 性能对比测试
- 错误处理示例
- CPU特性检测

### 3. 运行其他示例

#### 基本示例
```bash
./basic_example
```
演示基本的SM4加密解密操作。

#### 优化对比示例
```bash
./optimization_example
```
比较不同优化版本的性能差异。

#### GCM模式示例
```bash
./gcm_example
```
展示如何使用SM4-GCM模式进行认证加密。

#### 性能基准测试
```bash
./benchmark_example
```
提供详细的性能测试和基准测试功能。

## 示例文件说明

### run_example.c - 综合运行示例

功能包括：
- ✅ 基本加密解密演示
- ✅ GCM模式认证加密
- ✅ 性能对比测试
- ✅ 错误处理示例
- ✅ CPU特性检测

### basic_example.c - 基本示例
- 演示SM4基本加密解密操作
- 展示密钥和明文的使用方法
- 验证加密解密的正确性

### optimization_example.c - 优化示例
- 比较不同优化版本的性能
- 包括基本实现、T-table、AESNI等
- 显示各版本的吞吐量和延迟

### gcm_example.c - GCM模式示例
- 演示SM4-GCM认证加密模式
- 包含加密、解密、认证验证
- 测试不同数据长度的处理
- 验证认证失败检测

### benchmark_example.c - 基准测试
- 详细的性能基准测试
- 大数据性能测试
- 内存带宽测试
- CPU利用率测试

## 输出说明

### 性能数据
- **MB/s**: 每秒处理的兆字节数
- **延迟(ns)**: 单次操作的纳秒延迟
- **吞吐量**: 数据处理的速率

### 状态指示
- ✅ 成功/通过
- ✗ 失败/错误
- ⚠ 警告/注意

### CPU特性
- ✓ 支持: 当前CPU支持该指令集
- ✗ 不支持: 当前CPU不支持该指令集

## 故障排除

### 编译错误
1. 确保已安装gcc编译器
2. 检查是否在正确的目录下运行make
3. 确保所有源文件都存在

### 运行错误
1. 检查是否有执行权限
2. 确保在正确的目录下运行
3. 检查系统是否支持所需的CPU指令集

### 性能问题
1. 确保使用-O3优化编译
2. 检查CPU是否支持相关指令集
3. 关闭其他占用CPU的程序

## 扩展开发

### 添加新示例
1. 在 `examples/` 目录下创建新的 `.c` 文件
2. 在 `Makefile` 中添加新的示例目标
3. 更新 `README.md` 文档

### 自定义测试
1. 修改示例中的测试数据
2. 调整性能测试参数
3. 添加新的测试场景

## 联系支持

如果遇到问题，请：
1. 检查本文档的故障排除部分
2. 查看源代码中的注释
3. 运行 `make check_cpu` 检查CPU特性
4. 确保使用最新版本的代码

